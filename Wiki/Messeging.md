## 메시징

### 메시징 시스템의 개념

- 메시징 시스템의 종류에는 Kafka, RabbitMQ, ActiveMQ, AWS SQS, JAVA JMS 등이 있다
- MSA에서는 시스템간의 호출이 많기 때문에 결합도를 납추기 위해서 메시징 시스템을 사용한다

### 통신 방식

- Point to Point 방식
    - 보내는 사람이 큐를 통해서 메시지를 전달하면 받는 사람이 큐에서 하나씩 꺼내 읽는 방식
- Pub/Sub 방식
    - Publisher가 topic에 메시지를 보내면 해당 topic을 구독해놓은 Subscriber 모두에게 메시지가 전송되는 방식

### 용어 정리

- MOM(Momessage Oriented Middelware, 메시지 지향 미들웨어)
    - 독립된 애플리케이션 간에 데이터를 주고 받을 수 있도록 하는 시스템 디자인
    - 비동기로 메시지를 전달 하는 것이 특징
    - Quese, Boradcast, Multicast 등의 방식으로 메시지 전달
    - Pub/Sub 구조
- Message Broker
    - 메시지 처리 또는 메시지 수신자에게 메시지를 전달하는 시스템이며, 일반적으로 MOM을 기반으로 구축됨
    - MOM의 한 종류
- MQ(Message Queue)
    - Message Broker와 MOM을 구현한 소프트웨어(RabbitMQ, ActiveMQ, Kafaka ...)
    - MOM은 메시지 전송 보장을 해야하므로 AMQP를 구현한
- AMQP(Advanced Message Queuing Protocol)
    - 메시지를 안정적으로 주고받기 위한 인터넷 프로토콜

## Kafka

- 카프카는 메시징 시스템의 한 종류. 카프카의 보로커는 토픽을 기준으로 메시지를 관리한다
- 메시지를 보내는 측에서 토픽이라는 메시지 저장소에 메시지를 저장하고, 메시지를 가져가는 측에서 원하는 토픽에서 메시지를 가져가서 처리하게 된다
- 즉, Pub/Sub 구조이다
- 카프카는 확장성(scale-out)과 고가용성(high availability)를 위하여 브로커들이 클러스터로 구성되어 동작하도록 설계되어 있다
    - 심지어 브로커가 1개 밖에 없을 때에도 클러스터로써 동작 한다
    - 클러스터 내의 브로에 대한 분산 처리는 Apache ZooKeeper가 담당한다
- AMQP 프로토콜이나 JMS API를 사용하지 않고 단순한 메시지 헤더를 지는 TCP기반의 프로토콜을 사용하여 프로토콜에 의한 오버헤드를 감소시켰다
- 메세지를 기본적으로 메모리에 저장하는 기존 메시징 시스템과는 달리 메시지를 파일 시스템에 저장한다
- 기존의 메시징 시스템에서는 브로커가 컨슈머에게 메시지를 푸시해주는 방식인데 반해, 카프카는 컨슈머가 브로커로 부터 직접 메시지를 가지고가는 풀 방식으로 동작한다
- 따라서 컨슈머는 자신의 처리능력만큼의 메시지만 브로커로부터 가져오기 때문에 최적의 성능을 낼 수 있다 