## 컨텍스트 맵

- 로드맵
    - 프로젝트의 성공을 위해 처음 텍스트 맵이 필수적인 이유를 배우자
    - 의미 있는 컨텍스트 맵을 그리는 일이 얼마나 쉬운지 확인하자
    - 일반적인 조직과 시스템의 관게를 살펴보고 어떻게 프로젝트에 영향을 주는지 고려하자

- 프로젝트에서 컨텍스트 맵은 두 가지 방법으로 표현할 수 있다
    - 1> 다이어그램
        - 더 쉬운 방법은 두개 이상의 기존 바운디드 컨텍스트들 사이의 매핑을 보여주는 단순한 다이어 그램을 그리는 방법이다
        - 그러나 이 방법은 이미 존재하는 바운디드 컨텍스트를 단순한 다이어그램으로 다시 그리고 있을 뿐임을 기억해야 한다
        - 이 그림은 해결책 공간의 실제 소프트웨어 바운디드 컨텍스트가 통합을 통해 서로 어떻게 연결되는지를 나타낼 뿐이다
    - 2> 소스코드
        - 즉 통합(integration)의 소스 코드 구현을 사용하면 좀 더 상세하게 컨텍스트 맵을 나타낼 수 있다는 말이다

## 컨텍스트 맵이 필수적인 이유

<img src = "./img/IMG_6194.jpg" width = "600" height = "500">

- DDD를 위한 노력을 시작할 때 현재 프로젝트 상황의 시각적 컨텍스트 맵을 먼저 그리자
    - 프로젝트와 관련된 바운디드 컨텍스트와, 그사이의 통합 관게를 컨텍스트 맵으로 그리자
    - `필요한 해결책 공간의 관점을 제공하기 위한 목적에 초점을 두고 그려야 한다`
- 유용한 컨텍스트 맵을 만드는 방법을 살펴보자

### 컨텍스트 맵 그리기

- 기존 지형을 포착하자. 우선은 현재를 매핑해야 한다
- 다이어그램에 너무 많은 세부 내용을 추가하는 일은 팀에겐 전혀 실질적 도움을 주지 못한다. 절차적인 부분을 줄이고 단순함을 유지하며 애자일하게 움직여야 한다

### 프로젝트와 조직 관계

- 바운디드 컨텍스트와 개별적 프로젝트 팀 사이의 관계
    - 파트너쉽
        - 두 가지 컨텍스트 안의 팀이 성공이나 실패를 함께 한다면 협업 관계가 나타나야 한다
        - 팀들은 양측 시스템 모두의 개발 요구를 수용할 수 있는 인터페이스를 만들어 나가기 위해 반드시 협력해야 한다
        - 상호의존적인 기능은 반드시 일정을 세워 같은 릴리스에 완성할 수 있도록 해야 한다
    - 공유 커널
        - 모델에서 공유된 부분과 이에 관련되 코드는 아주 가까운 상호의존성을 형성하는데, 이는 설계 작업을 도울 수도 있고 약화시킬 수도 있다
        - 도메인 모델에서 팀이 공유하기로 동의한 부분집합 일부를 명시적 경계로 지정하자
        - 커널은 작게 유지하자
        - 이 명시적 공유는 특별한 상태에 놓이며, 다른 팀과의 상의 없이 변경해선 안된다
        - 커널 모델을 단단하게 유지하고 팀의 유비쿼너스 언어를 정돈해주는 지속적 통합 프로세스를 정의하라
    - 고객-공급자 개발
        - 두 팀이 업스트림과 다운스트림의 관계에 있고 업스트림 팀의 성공이 다운스트림 팀의 운명과 상호의존적이라면, 광범위한 결과를 초래할 다양한 방법으로 다운스트림 팀의 요수를 수용해야 한다
        - 업스트림 계획이 다운스트림 우선순위에 영향을 미친다
        - 협상과 작업 예산 편성을 다운스트림의 요구사항에 맞춰 진행해서, 모든 사람에게 약속과 일정을 이해시키자
    - 순응주의자
        - 업스트림 팀이 다운스트림 팀의 요구사항을 제공해줄 동기가 전혀 없는 업스트림/다운스트림 관계에서, 다운스트림 팀은 속수무책의 상황에 빠진다
        - 다운스트림 팀은 맹목적으로 업스트림 팀의 모델을 준수해서, 바운디드 컨텍스트 사이에 나타나는 변화의 복잡성을 제거한다
    - 부패 방지 계층 (ACL, Anticorruption Layer)
        - 변환 계층은 협조적인 팀 사이에서 잘 설계된 바운디드 컨텍스트를 연결할 때 간결하고 우아해질 수 있다
        - 그러나 공유 커널, 파트너, 고객-공급자 관계를 만들기에 제어나 의사소통이 적절하지 않다면 변환은 좀 더 복잡해진다
        - 변환 계층은 좀 더 방어적인 색깔을 띠게 된다
        - 다운스트림 클라이언트에는 분리 계층을 만들어서, 업스트림 시스템의 기능을 자신이 소유한 도메인 모델의 맥락에 맞춰 제공하라
    - 오픈 호스트 서비스(OHS, Open Host Language)
        - 여러분의 서브시스템에 접근할 수 있도록 해주는, 서비스 집합으로서의 프로토콜을 정의하자
        - 프로토콜을 열어서 여러분과 통합해야 하는 모든 이가 사용할 수 있도록 해주자
        - 단일 팀의 특이한 요구가 있지 않는 이상, 이 프로토콜을 강화하고 확장해서 새로운 통합 요구사항에 대응하자
        - REST 기반 리소스로 구현할 수 있다
        - 일반적으로는 오픈 호스트를 원격 프로시저 호출(RPC, Remote Procedure Call)API로 생각하지만, 메시지 교환을 사용해 구현할 수도 있다
    - 발행된 언어(PL, Published Language)
        - 두 바운디드 컨텍스트 모델 사이의 변환은 공통 언어를 필요로 한다
        - 공통의 의사소통 수단으로서 필수적인 도메인 정보를 표현할 수 있는 잘 문서화된 공유 언어를 사용해 필요에 맞춰 변환을 수정하자
        - 발행된 언어는 오픈 호스트 서비스와 종종 결합된다
        - 구현하는 방법에는 몇 가지가 있지만, 대개는 XML스키마로 구현한다
            - 이를 REST기반 서비스로 나타낼 땐 발행된 언어가 도메인 개념의 표현으로 렌더링된다
            - 예를 들어 XML과 JSON을 포함할 수 있다. 또한 구글 프로토콜 버퍼를 통해 표현을 랜더링 할 수도 있다
            - 웹 사용자 인터페이스를 게시하는 상황에선 여기에 HTML표현이 포함될 수도 있다
            - REST를 사용할 때의 이점은 각 클라이언트가 선호하는 언어를 지정할 수있고 해당 리소스는 요청 내용 타입에 맞춰서 표현을 렌더링한다는 점이다
            - 또한 REST는 하이퍼미디어 표현을 생성하는 이점도 있는데 이는 HATEOAS를 촉진한다. 하이퍼 미디어는 발행된 언어를 역동적이고 활발히 상호작용하도록 해주며, 이를 통해 클라이언트가
              연결된 리소스 집합을 찾을 수 있도록 해준다.. 이 언어는 표준 미디어 타입이나 사용자 지정 미디어 타입을 사용해 게시할 수 있다. 발행된 언어는 도메인 이베트가 관계된 구독자에게 메시지를
              전달하는 이벤트 주도 아키텍처에서도 사용할 수 있다
    - 분리된 방법
        - 요구사항을 정의할 때는 무자비해야만 한다
        - 만약 두 기능성 집합 사이에 유의미한 관계가 없다면, 이들은 서로가 완전히 분리돼야한다
        - 통합에는 항상 높은 비용이 필요하며, 그에 따른 유익함은 너무 작을 때가 많다
        - 바운디드 컨텍스트가 다른 것과 아무 연관이 없음을 선포해서, 개발자가 작은 범위 내에서 단순하고 전문화된 솔루션을 찾도록 해주자
    - 큰 진흙공
        - 기존 시스템을 조사해나가다 보면 여러 모델이 서로 뒤섞으고 경계는 일정하지 않은 상황에서 시스템을 구성하는 부분들을 찾게된다
        - 이런 어지러운 상황 전체를 아우르는 경계를 그리고 큰 진흙공으로 선언하자
        - 이 컨텍스트 안에 세련된 모델링을 적용해보려 애쓰지 말자
        - 이런 시스템이 다른 컨텍스트 안으로 제멋대로 퍼져나가려는 경향에 주의하자

### 세 가지 컨텍스트를 매핑하기

<img src = "./img/IMG_6198.jpg" width = "900" height = "700">

- `이게 핵심이다!!`
- 바운디드 컨텍스트끼리 어떻게 상호 작용을 할지를 나타내는 것이 바운디드 컨텍스트 맵이다
    - 그리고 이 맵에는 바운디드 컨텍스트 끼리 어떻게 상호작용을 하지가 표기되어 있다
    - 어떻게 상호작용을 할 지는 위에 있는 바운디드 컨텍스트의 관계(프로젝트와 조직 관계)에 따라 정해진다
    - 예시, A바운디드 컨텍스트와 B 바운디트 컨텍스틑 에서 A -> B는 오픈호스트 방식으로 상호작용한다

### 협업 컨텍스트

<img src = "./img/IMG_6199.jpg" width = "700" height = "600">
