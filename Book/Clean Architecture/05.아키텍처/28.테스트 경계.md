## 테스트 경계

- 테스트트 시스템의 일부이며, 아키텍처에도 관여한다

### 시스템 컴포넌트인 테스트

- 테스트에는 많은 종류가 있다 &rarr; 단위 테스트, 통합 테스트, 인수 테스트, 기능 테슽, TDD 테스트 등등
    - 하지만 아키텍처 관점에서는 모든 테스트가 동일하다
- 테스트는 태생적으로 의존성 규칙을 따른다
    - 테스트트 세부적이며 구체적인 것으로, 의존성은 항상 테스트 대상이 되는 코드를 향한다
    - 실제로 테스트는 아키텍처에서 가장 바깥쪽 원으로 생각할 수 있다
    - `시스템 내부의 어떤 것도 테스트에는 의존하지 않으며, 테스트는 시스템의 컴포넌트를 향해, 항상 원의 안쪽으로 의존한다`
    - 테스트는 독립적으로 배포 가능하다 &rarr; 대다수의 경우 테스트는 테스트 시스템에만 배포하며, 상용 시스템에는 배포하지 않는다
    - 시스템 컴포넌트 중에서 가장 고립되어 있다

### 테스트를 고려한 설계

- 시스템에 강하게 결합된 테스트는 시스템이 변경될 때 함께 변경되어야만 한다
    - 시스템 컴포넌트에서 생긴 아주 사소한 변경도, 이와 결합된 수많은 테스트를 망가뜨릴 수 있다 &rarr; `깨지기 쉬운 테스트 문제(Fragle Test Problem)`
- 깨지지 쉬운 테스트 문제를 해결하기 위해서는 테스트를 고려해서 설계해야 한다
    - 마찬가지로 설계의 첫 번째 규칙은 언제나 같다 &rarr; 변동성이 있는 것에 의존하지 말라
    - ex) GUI는 변동성이 크기 때문에 GUI를 사용하지 않고 업무 규칙을 테스트할 수 있게 해야 한다

### 테스트 API

- 깨지기 쉬운 테스트 문제를 해결하기 위해서는 테스트가 모든 업무 규칙을 검증하는 데 사용할 수 있도록 특화된 API를 만들면 된다
    - 이러한 API는 보안 제약사항을 무시할 수 있드며(데이터베이스와 같은)값비싼 자원은 건너뛰고, 시스템을 테스트 가능한 특정 상태로 강제하는 강력한 힘을 지녀야 한다
    - 이 API는 사용자 인터페이스가 사용하는 인터렉터(interactor)와 인터페이스 어댑어(Interface Adaptor)들의 상위 집합이 될 것이다
    - 테스트 API는 테스트를 애플리케이션으로부터 분리할 목적으로 사용한다
    - `단순히 테스트를 UI에서 분리하는 것만이 아닌, 테스트 구조를 애플리케이션 구조로부터 결합을 분리하는게 목표다`
- 구조적 결합
    - 구조적 결합은 테스트 결합 중에서 가장 강하며, 가장 은밀하게 퍼져 나가는 유형이다
        - 모든 상용 클래스에 테스트 클래스가 각각 존재하고, 모든 상용 메서드에 테스트 메서드가 있다고 할 경우, 테스트는 애플리케이션 구조에 강하게 결합된다
        - 상용 클래스나 메서드 중 하나라도 변경되면 딸려 있는 다수의 테스트가 변경 되어야 하고, 결과적으로 테스트는 깨지기 쉽다
    - 테스트 API의 역할은 애플리케이션의 구조를 테스트로부터 숨기는데 있다
        - 이렇게 만들면 상용 코드를 리팩터링하거나 진화시켜도 테스트에는 영향을 주지 않는다
        - 애플리케이션과 테스트가 따로 진화할 수 있다는 점이 필수적이다. 시간이 지날수록 테스트는 계속해서 더 구체적이고 더 특화된 형태로 변할 것이고, 사용 코드는 더 추상적이고 더 범용적인 형태로 변할
          것이다
- 보안
    - 테스트 API가 지닌 강력한 힘을 운영 시스템에 배포하면 위험에 처할 수 있다
    - 위험을 피하고 싶다면 테스트 API 자체와 테스트 API 중 위험한 부분의 구현부는 독립적으로 배포할 수 있는 컴포넌트로 분리해야 한다

### 결론

- 테스트는 시스템 외부에 있지 않다. 오히려 시스템의 일부다
- 테스트를 시스템의 일부로 설계하지 않으면 테스트는 깨지기 쉽고 유지보수하기 어려워지는 경향이 있기 때문에 잘 설계 돼야만 한다